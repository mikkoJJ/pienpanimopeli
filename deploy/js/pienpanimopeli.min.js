var Brew={game:null,noCursor:false,products:[]};(function(){Brew.Booter=function(){return};Brew.Booter.prototype={preload:function(){WebFont.load({google:{families:["VT323","Press Start 2P"]}});console.log("BOOT: Web fonts loaded.");return},update:function(){this.state.add("Preloader",Brew.Preloader,true)}}})();(function(){var game=new Phaser.Game(960,720,Phaser.AUTO,"game");game.state.add("Booter",Brew.Booter,true);Brew.game=game})();(function(){Brew.Preloader=function(){return};Brew.Preloader.prototype={create:function(){this.state.add("Main",Brew.Main)},preload:function(){this.progress=this.game.add.text(this.game.width/2,this.game.height/2,"Loading: 0 %",{font:'40pt bold "Press Start 2P"',fill:"#FFFFFF"});this.progress.anchor.set(.5);this.progress.fixedToCamera=true;Brew.game.plugins.add(new Phaser.Plugin.Isometric(Brew.game));this.load.image("kattila","assets/sprites/single_sprites/kattila.png");this.load.image("paa_kattila_luonnos","assets/sprites/single_sprites/paa_kattila_luonnos.png");this.load.atlasJSONHash("sprites","assets/sprites/brew_sprites.png","assets/sprites/brew_sprites_data.json");this.load.json("texts","assets/json/texts.json");console.log("PRELOAD: Images loaded");Brew.gui=new Brew.GUI;console.log("PRELOAD: GUI initialized")},loadUpdate:function(){this.progress.text="Loading: "+this.load.progress+" %"},update:function(){this.state.start("Main")}}})();(function(){var settings={tileSize:38};var letter,budget=5e4,lauterer,fermenter,maturer,bottler,lagerStorage,porterStorage,darkStorage,storageManager,resourceStorage,person,person2,floor,spending,text,orderList=[],buyerList=[],buyers,soDirtyEverywhere=0,illegalAds=0;Brew.Main=function(){return};Brew.Main.prototype={create:function(){this.game.iso.anchor.setTo(.5,.3);this.messages=new Brew.Messages;this.isoGroup=this.add.group();this.floor=new Brew.Floor;this.floor.makeFloor(this.game,this.isoGroup);resourceStorage=new Brew.Storage(this.game,"consumable",this.isoGroup,"Ohramallasta");resourceStorage.base.x=4*settings.tileSize;resourceStorage.base.y=8*settings.tileSize;resourceStorage.amount=5;resourceStorage.name="Ohramallasta";storageManager=new Brew.StorageManager;lauterer=new Brew.Producer(this.game,8*settings.tileSize,8*settings.tileSize,0,"kettle1",this.isoGroup);lauterer.resource=resourceStorage;fermenter=new Brew.Producer(this.game,8*settings.tileSize,5*settings.tileSize,0,"kettle3_with_bubbles",this.isoGroup);maturer=new Brew.Producer(this.game,8*settings.tileSize,2*settings.tileSize,0,"kettle4",this.isoGroup);bottler=new Brew.Producer(this.game,5*settings.tileSize,2*settings.tileSize,0,"bottlemachine_step1",this.isoGroup);fermenter.addOption("Tee lageria","lagerbutton","type",Brew.BeerType.LAGER);fermenter.addOption("Tee IPAa","ipabutton","type",Brew.BeerType.IPA);fermenter.addOption("Tee tummaa","darkbutton","type",Brew.BeerType.DARK);maturer.addOption("Pitkä kypsytys","long_brew","taste","Pehmeää");maturer.addOption("Pitkä kypsytys","short_brew","taste","Kitkerää");Brew.Producer.setChain(lauterer,fermenter,maturer,bottler);bottler.onBeerFinished.bind(this.beerFinished,this);var pipes=this.add.isoSprite(7*settings.tileSize,2.8*settings.tileSize,10,"sprites","pipes2",this.isoGroup);pipes.anchor.set(.5,.5);pipes=this.add.isoSprite(7*settings.tileSize,6*settings.tileSize,10,"sprites","pipes",this.isoGroup);pipes.anchor.set(.5,.5);person=new Person(this.game,1*settings.tileSize,4*settings.tileSize,10,this.isoGroup,this.floor);person2=new Person(this.game,1*settings.tileSize,7*settings.tileSize,10,this.isoGroup,this.floor);var coin=this.add.button(940,0,"sprites",function(){},this,"money_symbol","money_symbol");coin.anchor.setTo(.5,0);Brew.gui.resources("Osta 1 erä raaka-aineita",this.buyMaterials,this);var seek=this.add.button(900,75,"sprites",function(){var mess=(new Brew.Messages).getMessage();Brew.gui.addMessage("Mainosta",mess.content,null,"Oi kyllä!",function(){this.ad(mess)},this);letter.frameName="letter_new_open 2"},this,"seek-employee-symbol","seek-employee-symbol");seek.anchor.setTo(.5,0);var mallas=this.add.button(900,190,"sprites",this.buyMaterials,this,"consumable","consumable");mallas.anchor.setTo(.5,0);letter=this.add.button(50,5,"sprites",function(){Brew.gui.toggleMessages()},this,"letter_new_empty1","letter_new_unopened","letter_new_empty1","letter_new_empty1");letter.anchor.setTo(.5,0);Brew.Budget.create();Brew.Budget.moveProgressBar();Brew.Budget.update(5e4);spending=$("#kulutus").val();$("#kulutus").on("blur",function(){spending=$(this).val()});text=this.add.text(880,18,budget);text.fill="#FFFFFF";text.anchor.setTo(.5,0);text.number=budget;changeText=this.add.text(880,45,"");changeText.fill="#FFFFFF";changeText.anchor.setTo(.5,0);var tutorialTime=0;this.time.events.add(Phaser.Timer.SECOND*tutorialTime,function(){},this);this.time.events.loop(Phaser.Timer.SECOND*20,function(){this.budgetHandling(-spending)},this);this.time.events.loop(Phaser.Timer.SECOND*20,function(){this.cleanUp()},this)},cleanUp:function(){var clean=this.add.isoSprite(Brew.game.rnd.integerInRange(50,200),Brew.game.rnd.integerInRange(50,200),100,"sprites","dirt",this.isoGroup);soDirtyEverywhere++;if(soDirtyEverywhere%10==0)Brew.gui.alert("Hygieniasi on epäilyttävää. Sait sakot.",this.budgetHandling(-100),this);clean.inputEnabled=true;clean.events.onInputDown.add(function(){clean.destroy();soDirtyEverywhere--},this)},buyMaterials:function(){var price=-$("#aineet").val();this.budgetHandling(price);var beerType=Brew.gui.resourceWindow.data("type");resourceStorage.amount+=1},ad:function(mess){this.budgetHandling(-parseInt(mess.due));var warning="";if(mess.title!="Laillinen"){illegalAds++;this.sendBrag(mess.dueText,function(){});if(illegalAds==5){Brew.gui.alert("Olet mainostanut liikaa laittomasti. Menetit toimilupasi ja hävisit pelin.");return}else warning="Tämä on "+illegalAds+". laiton mainos"}else this.createBuyer();Brew.gui.alert(mess.dueText+" "+warning)},sendBrag:function(caption,callback){FB.ui({method:"feed",caption:caption,picture:"localhost:8080/pienpanimopeli/assets/sprites/single_sprites/giantcan.png",name:"Testing"},callback)},hire:function(){spending=parseInt(spending)+500;var employee=new Person(Brew.game,Brew.game.rnd.integerInRange(0,9)*settings.tileSize,9*settings.tileSize,10,this.isoGroup,this.floor)},sell:function(order){var storagei;for(i in storageManager.storages){var beerTypeIndex=storageManager.storages[i].type;var name=this.getType(beerTypeIndex);console.log(storageManager.storages[i].description);if(name==order.type)storagei=i}if(storageManager.storages[storagei]==undefined)return false;console.log(storageManager.storages[storagei].description);if(storageManager.storages[storagei].amount<order.amount)return false;else if(order.buyer=="Erkki Virtanen"){this.budgetHandling(-10);Brew.gui.alert("Yksityishenkilölle myyminen on laitonta! Sait sakot.")}else{this.budgetHandling(order.price*order.amount);storageManager.storages[storagei].amount-=order.amount;var index=-1;for(var i=0,j=orderList.length;i<j;i++){if(orderList[i]===order)index=i}orderList.splice(index,1)}},getType:function(typeIndex){var types=["lager","IPA","dark"];return types[typeIndex]},beerFinished:function(beer){storageManager.addBeer(beer,4);this.initialBuyers()},initialBuyers:function(){var initial=(new Order).initialBuyers();for(i in initial){buyerList.push(initial[i]);if(storageManager.storages.length>0)this.time.events.loop(Phaser.Timer.SECOND*15,this.updateOrders,this,initial[i])}console.log(buyerList)},createBuyer:function(){var order=new Order;var buyer=order.newBuyer();buyerList.push(buyer);this.time.events.loop(Phaser.Timer.SECOND*25,this.updateOrders,this,buyer);console.log(buyerList)},updateOrders:function(buyer){if(buyerList==0){Brew.gui.alert("Menetit kaikki tilaajasi.");return}var names=[storageManager.storages[0].description];if(buyer!=undefined){var order=(new Order).random(buyer,names);orderList.push(order);Brew.gui.addMessage("Tilaus",order.message(),order,"Myy",this.sell,this,this.remove);letter.frameName="letter_new_open 2"}},remove:function(order){order.buyers.splice(order.getIndex(),1);console.log(buyerList)},budgetHandling:function(money){budget=budget+money;changeText.setText(money);if(money>=0)changeText.fill="#106906";else changeText.fill="#EE0A0A";this.time.events.add(2e3,function(){changeText.setText("")},this);if(budget<=0){Brew.gui.alert("Menetit kaikki rahasi ja hävisit pelin.");Brew.Budget.update(budget);text.setText(budget)}else if(budget>=1e5){Brew.gui.alert("Liikevoittosi on ilmiömäinen. Voitit pelin!");Brew.Budget.update(budget);text.setText(budget)}else{Brew.Budget.startBudget(budget,text)}},update:function(){this.game.iso.simpleSort(this.isoGroup);this.messages.update();storageManager.update();resourceStorage.update();this.floor.update();if(budget<=1e5&&budget>=0){text.setText(Math.floor(text.number))}else{text.setText(budget)}var secondsToDisappear=6e4;orderList.forEach(function(order){if(Brew.game.time.now-order.age>secondsToDisappear){var allListElements=$(".brew-message");allListElements.each(function(index){if($(this).data("messageData")==order){$(this).remove();order.buyers.splice(order.getIndex(),1);console.log(buyerList.length);orderList.shift();return}})}})}};var Person=function(game,x,y,z,group,floor){Phaser.Plugin.Isometric.IsoSprite.call(this,game,x,y,z,"sprites","mies",group);this.anchor.set(.5,.75);this.floor=floor;this.moving=false;this._frameUnselected="mies";this._frameSelected="mies_selected";this.inputEnabled=true;this.events.onInputDown.add(function(){this.floor.person=this},this);this.events.onInputOver.add(function(){this.frameName=this._frameSelected},this);this.events.onInputOut.add(function(){this.frameName=this._frameUnselected},this);game.add.existing(this);group.add(this)};Person.prototype=Object.create(Phaser.Plugin.Isometric.IsoSprite.prototype);Person.prototype.constructor=Person;Brew.Person=Person;var Order=function(type,amount,buyer,name){this.age=Brew.game.time.now;this.type=type;this.amount=amount;this.buyer=buyer;this.name=name;this.buyers=buyerList;var pieni=1;var suuri=15;this.staticBuyers=[["Alko",suuri],["Kesko",suuri],["S-Ryhmä",suuri],["Musta Kynnys",pieni],["Ale Pub",pieni],["Erkki Virtanen",pieni]];this.price=$("#hinta").val();$("#hinta").on("blur",function(){this.price=$(this).val()})};Order.prototype.initialBuyers=function(){var buyers=[["Hemingways",1],["Vakiopaine",1]];return buyers};Order.prototype.getIndex=function(){for(var i=0,j=this.buyers.length;i<j;i++){if(this.buyers[i]===this.buyer){return i}}return-1};Order.prototype.newBuyer=function(){var buyer=this.staticBuyers[Brew.game.rnd.integerInRange(0,this.staticBuyers.length)];return buyer};Order.prototype.random=function(buyer,names){var types=["lager","IPA","dark"];var amountType=buyer[1];var amount=Brew.game.rnd.integerInRange(amountType,amountType+5);return new Order(types[Brew.game.rnd.integerInRange(0,types.length-1)],amount,buyer[0],names[Brew.game.rnd.integerInRange(0,names.length-1)])};Order.prototype.message=function(){return this.amount+" koria: "+this.type+" Tilaaja:"+this.buyer};Brew.Order=Order})();(function(){var Messages=function(){};Messages.prototype={update:function(){},getMessage:function(){var data=Brew.game.cache.getJSON("texts");var message=data.ads[Math.floor(Math.random()*data.ads.length)];return message}};Brew.Messages=Messages})();(function(){var settings={dom:"#game",messagesAnimationSpeed:100,messagesHoverSpeed:100};var GUI=function(){this._messageWindow=$("<div><div/>").addClass("brew-messages").appendTo(settings.dom);this.resourceWindow=null;this.seekWindow=null;this.infoWindows=[]};GUI.prototype.resources=function(message,callback,callbackCtx){this.resourceWindow=$("<div><div/>").addClass("brew-window brew-resources").html(message).append(this.__makeButton("Osta",function(){var p=$(this).parent();p.data("type",Brew.BeerType.LAGER);if(p.data("callback"))p.data("callback").call(p.data("callbackCtx"));p.hide("drop",{direction:"right"},200,"easeInBack",function(){this.remove()})})).appendTo(settings.dom).data("callback",callback).data("callbackCtx",callbackCtx)};GUI.prototype.seek=function(message,callback,callbackCtx){this.seekWindow=$("<div><div/>").addClass("brew-window brew-resources").html(message).append(this.__makeButton("OK",function(){var p=$(this).parent();if(p.data("callback"))p.data("callback").call(p.data("callbackCtx"));p.hide("drop",{direction:"right"},200,"easeInBack",function(){this.remove()})})).appendTo(settings.dom).data("callback",callback).data("callbackCtx",callbackCtx)};GUI.prototype.toggleSeek=function(message,callback,callbackCtx){this.seekWindow.toggle("slide",{direction:"right"},200)};GUI.prototype.toggleResources=function(message,callback,callbackCtx){this.resourceWindow.toggle("slide",{direction:"right"},200)};GUI.prototype.alert=function(message,callback,callbackCtx){$("<div><div/>").addClass("brew-window brew-alert").html(message).append(this.__makeButton("OK",function(){var p=$(this).parent();if(p.data("callback"))p.data("callback").call(p.data("callbackCtx"));p.hide("drop",200,"easeInBack",function(){this.remove()})})).appendTo(settings.dom).show("drop",200,"easeOutBack").data("callback",callback).data("callbackCtx",callbackCtx)};GUI.prototype.showInfo=function(x,y,message){var w=$("<div></div>").addClass("brew-info-window brew-window").appendTo(settings.dom).css({left:x,top:y}).html(message).show({effect:"scale",origin:["left","center"],duration:80});return w};GUI.prototype.hideInfo=function(window){window.hide({effect:"scale",origin:["left","center"],duration:80,complete:function(){$(this).remove()}})};GUI.prototype.query=function(message,callback,callbackCtx){$("<div><div/>").addClass("brew-window brew-alert").html(message).append($("<input/>").attr({type:"text",id:"brew-query"})).append(this.__makeButton("OK",function(){var p=$(this).parent();var answer=p.children("#brew-query").val();if(p.data("callback"))p.data("callback").call(p.data("callbackCtx"),answer);p.hide("drop",200,"easeInBack",function(){this.remove()})})).appendTo(settings.dom).show("drop",200,"easeOutBack").data("callback",callback).data("callbackCtx",callbackCtx)};GUI.prototype.addMessage=function(header,message,data,buttonText,buttonCallback,buttonCallbackCtx,rejectCallback){FB.XFBML.parse();var _w=$("<div><div/>").addClass("brew-window brew-message").html("<h2>"+header+"<h2>").append($("<div><div/>").addClass("brew-message-body brew-window").html(message).append(this.__shareButton().data("callback",buttonCallback).data("callbackCtx",buttonCallbackCtx)).append(this.__makeButton("Hylkää",function(){var remove=true;if($(this).data("rejectCallback"))remove=$(this).data("rejectCallback").call($(this).data("callbackCtx"),$(this).parent().parent().data("messageData"));if(remove!==false)$(this).parent().parent().hide("fold",200,"easeInBack",function(){$(this).parent().parent().remove()});else e.stopPropagation()}).data("rejectCallback",rejectCallback))).click(this.__messageWindowClicked).hover(this.__messageWindowHover,this.__messageWindowHover).data("messageData",data).appendTo(this._messageWindow);if(buttonText){_w.append(this.__makeButton(buttonText,function(e){var $this=$(this);var remove=true;if($this.data("callback"))remove=$this.data("callback").call($this.data("callbackCtx"),$this.parent().data("messageData"));if(remove!==false)$this.parent().hide("fold",200,"easeInBack",function(){$(this).remove()});else e.stopPropagation()}).css({display:"none"}).data("callback",buttonCallback).data("callbackCtx",buttonCallbackCtx))}};GUI.prototype.toggleMessages=function(){this.__closeOpenMessages();this._messageWindow.toggle("slide",{easing:"easeOutBounce"},200)};GUI.prototype.__shareButton=function(callback){return $("<div></div>").addClass("fb-share-button").data("send",true).data("href","localhost:8080/pienpanimopeli/assets/sprites/single_sprites/bottle.png").data("action",callback).css({margin:"0px","float":"right"}).click(callback)};GUI.prototype.__makeButton=function(text,callback){return $("<div></div>").addClass("brew-button").addClass("jotain").text(text).click(callback)};GUI.prototype.__messageWindowHover=function(){$(this).toggleClass("brew-message-extended",settings.messagesHoverSpeed)};GUI.prototype.__closeOpenMessages=function(){$(".brew-message-open").each(function(){$(this).toggleClass("brew-message-open",settings.messagesAnimationSpeed,"easeOutBounce");$(this).children(".brew-message-body, .brew-button").toggle("fold",{direction:"up",easing:"easeOutQuad"},settings.messagesAnimationSpeed)})};GUI.prototype.__messageWindowClicked=function(){var $this=$(this);if(!$this.hasClass("brew-message-open")){$(".brew-message-open").each(function(){$(this).toggleClass("brew-message-open",settings.messagesAnimationSpeed,"easeOutBounce");$(this).children(".brew-message-body, .brew-button").toggle("fold",{direction:"up",easing:"easeOutQuad"},settings.messagesAnimationSpeed)})}$this.toggleClass("brew-message-open",settings.messagesAnimationSpeed,"easeOutBounce");$this.children(".brew-message-body, .brew-button").toggle("fold",{direction:"up",easing:"easeOutQuad"},settings.messagesAnimationSpeed)};Brew.GUI=GUI})();(function(){var settings={dom:"#progressbar",progressStyle:{width:"100%",height:"25px"},wrapStyle:{background:"#f80",margin:"10px",overflow:"hidden",position:"relative"},barStyle:{background:"#ddd",left:"0",position:"absolute",top:"0"}};var div;var bar;var full=1e5;var tween;var Budget=function(){};Budget.prototype.startBudget=function(budget,text){this.tween=Brew.game.add.tween(text).to({number:budget},1e3,Phaser.Easing.Linear.None,true);this.update(budget)};Budget.prototype.update=function(money){var percent=money/1e3;var message;if(percent<=0){percent=0;this.tween.stop()}else if(percent>=100){percent=100;this.tween.stop()}else message="";div.data("percent",percent);this.moveProgressBar();return message};Budget.prototype.moveProgressBar=function(){var getPercent=div.data("percent")/100;var getProgressWrapWidth=div.width();var progressTotal=getPercent*getProgressWrapWidth;var animationLength=250;bar.stop().animate({left:progressTotal},animationLength)};Budget.prototype.create=function(){bar=$("<div>").css(settings.progressStyle).css(settings.barStyle);div=$("<div>").css(settings.progressStyle).css(settings.wrapStyle).data("percent",100).append(bar).appendTo(settings.dom)};Brew.Budget=new Budget})();(function(){Brew.BeerType={LAGER:0,IPA:1,DARK:2};Brew.BeerTypeDescriptions=["lageria","ipaa","tummaa olutta"];Brew.BeerSprites=["lager_case","porter_case","dark_case"];var Beer=function(type,taste){var _type=type?type:Brew.BeerType.LAGER;var _taste=taste?taste:"pehmeää";this.type=_type;this.taste=_taste};Beer.prototype.constructor=Beer;Beer.prototype.getSprite=function(){return Brew.BeerSprites[this.type]};Object.defineProperty(Beer.prototype,"id",{get:function(){return""+this.type}});Object.defineProperty(Beer.prototype,"description",{get:function(){return this.taste+" "+Brew.BeerTypeDescriptions[this.type]}});Brew.Beer=Beer})();(function(){var settings={tileWidth:38,caseHeight:18,pileHeight:5,pileWidth:3,caseValue:1};var Storage=function(game,spriteName,group,description,type){this._game=game;this._group=group;this._frame=spriteName;this._frameSelected=spriteName+"_selected";this._amount=0;this._cases=[];this._current={x:0,y:0,z:0};this.name="Nimetön";this.base={x:0,y:0,z:0};this.description=description;this.type=type};Storage.prototype.constructor=Storage;Storage.prototype.addCase=function(){var _case=this._game.add.isoSprite(0,0,0,"sprites",this._frame,this._group);_case.anchor.set(.5,.76);_case.isoX=this.base.x+settings.tileWidth*this._current.x;_case.isoY=this.base.y+settings.tileWidth*this._current.y;_case.isoZ=this.base.z+settings.caseHeight*this._current.z;_case.inputEnabled=true;_case.events.onInputOver.add(function(){this._mouseOver=true},_case);_case.events.onInputOut.add(function(){this._mouseOver=false},_case);_case.casePosition={x:this._current.x,y:this._current.y,z:this._current.z};if(++this._current.z>=settings.pileHeight){if(++this._current.x>=settings.pileWidth){this._current.y++;this._current.x=0}this._current.z=0}this._cases.push(_case)};Storage.prototype.removeCase=function(){var _case=this._cases.pop();this._current.x=_case.casePosition.x;this._current.y=_case.casePosition.y;this._current.z=_case.casePosition.z;_case.destroy()};Storage.prototype.moveEmployee=function(){Brew.game.add.tween(Brew.Person).to({isoX:this._current.x+130,isoY:this._current.y,isoZ:0},2e3,Phaser.Easing.Linear.None,true,0,0,false)};Storage.prototype.update=function(){var _mouse=false;for(var i=0;i<this._cases.length;i++){if(this._cases[i]._mouseOver){_mouse=true;break}}if(_mouse&&!this._selected){this._selected=true;for(var j=0;j<this._cases.length;j++){this._cases[j].frameName=this._frameSelected}var infoPosition=this._game.iso.project(new Phaser.Plugin.Isometric.Point3(this.base.x+settings.tileWidth*1,this.base.y+settings.tileWidth*1,this.base.z+settings.tileWidth*settings.pileHeight));this._info=Brew.gui.showInfo(infoPosition.x-100,infoPosition.y+50,"<b>"+this.name+":</b> "+this.amount)}if(!_mouse&&this._selected){this._selected=false;for(var k=0;k<this._cases.length;k++){this._cases[k].frameName=this._frame}Brew.gui.hideInfo(this._info)}};Object.defineProperty(Storage.prototype,"amount",{get:function(){return this._amount},set:function(newAmount){var caseDifference=Math.floor(newAmount/settings.caseValue)-this._cases.length;if(caseDifference<0)for(var i=caseDifference;i<0;i++)this.removeCase();else for(var j=0;j<caseDifference;j++)this.addCase();this._amount=newAmount}});Brew.Storage=Storage})();(function(){var settings={tileSize:38};var graph=[[0,0,1,1,1,1,1,1,1,1],[0,0,1,1,0,0,1,0,0,1],[1,1,1,1,0,0,1,0,0,1],[0,0,1,1,1,1,1,1,1,1],[0,0,1,1,1,1,1,0,0,1],[1,1,1,1,1,1,1,0,0,1],[0,0,1,1,1,1,1,1,1,1],[0,0,1,1,1,1,1,0,0,1],[1,1,1,1,0,0,0,0,0,1],[0,0,1,1,0,0,0,1,1,1]];var easystar=new EasyStar.js;var intervals={};easystar.setIterationsPerCalculation(10);var Floor=function(){this.grid=easystar.setGrid(graph);easystar.setAcceptableTiles([1]);this.person=Brew.person;this.destination=null};Floor.prototype.makeFloor=function(game,isoGroup){var tile;for(var xx=0;xx<10*settings.tileSize;xx+=settings.tileSize){for(var yy=0;yy<10*settings.tileSize;yy+=settings.tileSize){tile=game.add.isoSprite(xx,yy,0,"sprites","floor",isoGroup);tile.inputEnabled=true;tile.events.onInputDown.add(this.move,this,{param1:tile});tile.anchor.set(.5,.5)}}};Floor.prototype.setElement=function(element){graph[Math.floor(element.isoX/settings.tileSize)][Math.floor(element.isoY/settings.tileSize)]=0;this.grid=easystar.setGrid(graph)};Floor.prototype.move=function(destination){var person=this.person;this.destination=destination;if(person==undefined||person.moving==true){return}var start=[Math.floor(person.isoX/settings.tileSize),Math.floor(person.isoY/settings.tileSize)];var end=[Math.floor(this.destination.isoX/settings.tileSize),Math.floor(this.destination.isoY/settings.tileSize)];easystar.findPath(start[0],start[1],end[0],end[1],function(path){if(path===null){}else{person.moving=true;var id=setInterval(function(){person.isoX=path[0].x*settings.tileSize;person.isoY=path[0].y*settings.tileSize;path.splice(0,1);if(path.length==0){person.moving=false;finished=true;delete intervals[id];clearInterval(id)}},200);intervals[id]=true}});graph[start[0]][start[1]]=0;graph[end[0]][end[1]]=1;this.grid=easystar.setGrid(graph)};Floor.prototype.update=function(){easystar.calculate()};Brew.Floor=Floor})();(function(){Brew.ProducerState={IDLE:0,PROCESSING:1,DONE:2};var STATE_ICONS=["producer_idle","producer_active","producer_done"];var Producer=function(game,x,y,z,frame,group){this._sprite=game.add.isoSprite(x,y,z,"sprites",frame,group);this._game=game;this._state=Brew.ProducerState.IDLE;this.next=null;this.previous=null;this.beer=null;this.resource=null;this.isFinal=false;this.workDuration=10;this.optionOffset={x:-30,y:-70};this.onBeerFinished={bind:function(callback,ctx){this._callback=callback;this._ctx=ctx},fire:function(arg){if(this._callback)this._callback.call(this._ctx,arg)}};this._selectedOption=0;this._options=[];this._frame=frame;this._frameSelected=frame+"_selected";this._sprite.anchor.setTo(.5,.97);this._sprite.inputEnabled=true;this._sprite.events.onInputDown.add(this._inputDown,this);this._sprite.events.onInputOver.add(this._inputOver,this);this._sprite.events.onInputOut.add(this._inputOut,this);this._indicator=game.add.isoSprite(x,y,z+140,"sprites","producer_idle",group);this._indicator.anchor.set(.5,.5);this._indicator.pivot.set(.5,.5);game.add.tween(this._indicator).to({isoZ:z+145},1800,Phaser.Easing.Quadratic.InOut,true,0,-1,true)};Producer.prototype.constructor=Producer;Producer.prototype.begin=function(from){var beer;if(from){beer=from.beer;from.end()}else beer=new Brew.Beer;if(this.resource){this.resource.amount-=1}this.beer=beer;if(this.currentOption)beer[this.currentOption._parameter]=this.currentOption._value;var workTween=this._game.add.tween(this._sprite.scale).to({x:1.02,y:1.02},100,Phaser.Easing.Linear.None,true,0,this.workDuration,true);workTween.onComplete.add(function(){this.state=Brew.ProducerState.DONE;if(!this.next){this.onBeerFinished.fire(this.beer);this.end()}else{this.next.begin(this)}},this);this.state=Brew.ProducerState.PROCESSING};Producer.prototype.end=function(){this.state=Brew.ProducerState.IDLE;this.beer=null};Producer.prototype.addOption=function(name,sprite,parameter,value){var option=this._game.add.sprite(this._sprite.x+this.optionOffset.x,this._sprite.y+this.optionOffset.y,"sprites",sprite+"_over");if(this._options.length>0)option.frameName=sprite+"_out";option.visible=false;option._parameter=parameter;option._value=value;option._sprite=sprite;this._options.push(option)};Object.defineProperty(Producer.prototype,"state",{get:function(){return this._state},set:function(newState){this._state=newState;this._indicator.frameName=STATE_ICONS[newState];if(newState==Brew.ProducerState.PROCESSING){this._indicatorTween=this._game.add.tween(this._indicator).to({rotation:Math.PI*2},800,Phaser.Easing.Cubic.In,true,0,-1,false)}else{this._indicatorTween.stop();this._indicator.rotation=0}}});Object.defineProperty(Producer.prototype,"selectedOption",{get:function(){return this._selectedOption},set:function(newOptionNum){var oldOption=this._options[this._selectedOption];var newOption=this._options[newOptionNum];oldOption.frameName=oldOption._sprite+"_out";newOption.frameName=newOption._sprite+"_over";this._selectedOption=newOptionNum}});Object.defineProperty(Producer.prototype,"currentOption",{get:function(){return this._options[this.selectedOption]}});Producer.prototype._inputDown=function(){if(this.state==Brew.ProducerState.IDLE){if(!this.previous){this.begin()}}if(this._options.length>0){if(this.selectedOption>=this._options.length-1)this.selectedOption=0;else this.selectedOption=this.selectedOption+1}};Producer.prototype._inputOver=function(){this._sprite.frameName=this._frameSelected;var theta=0;var r=40;var toX,toY;var option;for(var i=0;i<this._options.length;i++){option=this._options[i];option.visible=true;theta=i*(Math.PI*2*(1/6));toX=this._sprite.x+this.optionOffset.x+r*Math.cos(theta);toY=this._sprite.y+this.optionOffset.y+r*Math.sin(theta);this._game.add.tween(option).to({x:toX,y:toY},300,Phaser.Easing.Cubic.Out,true)}};Producer.prototype._inputOut=function(){this._sprite.frameName=this._frame;for(var i=0;i<this._options.length;i++){var option=this._options[i];option.visible=false;option.x=this._sprite.x+this.optionOffset.x;option.y=this._sprite.y+this.optionOffset.y}};Producer.setChain=function(){for(var i=0;i<arguments.length;i++){arguments[i].previous=arguments[i-1];arguments[i].next=arguments[i+1]}};Brew.Producer=Producer})();(function(){var settings={tileSize:38};var StorageManager=function(){this.storages={};this.base={x:0,y:0,z:0}};StorageManager.prototype.constructor=StorageManager;StorageManager.prototype.addBeer=function(beer,amount){if(!this.storages[beer.id])this.newStorage(beer);this.storages[beer.id].amount+=amount};StorageManager.prototype.newStorage=function(beer){var _storage=new Brew.Storage(Brew.game,beer.getSprite(),this._group,beer.name,beer.type);_storage.base={x:this.base.x,y:this.base.y,z:this.base.z};this.base.y+=2*settings.tileSize;this.storages[beer.id]=_storage;this._naming=beer.id;Brew.gui.query("Olet kehittänyt uudenlaisen oluen! Tuottamasi olut on <b>"+beer.description+"</b>! <br /><br />Anna tuotteelle nimi:",function(ans){this.storages[this._naming].name=ans;Brew.products.push(this._naming)},this)};StorageManager.prototype.update=function(){for(var i in this.storages){this.storages[i].update()}};Brew.StorageManager=StorageManager})();window.fbAsyncInit=function(){FB.init({appId:"349671038558260",frictionlessRequests:true,xfbml:true,status:true,version:"v2.3"})};(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id)){return}js=d.createElement(s);js.id=id;js.src="//connect.facebook.net/fi_FI/sdk.js";fjs.parentNode.insertBefore(js,fjs)})(document,"script","facebook-jssdk");