window.fbAsyncInit=function(){FB.init({appId:"349671038558260",frictionlessRequests:true,xfbml:true,status:true,version:"v2.3"})};(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id)){return}js=d.createElement(s);js.id=id;js.src="//connect.facebook.net/fi_FI/sdk.js";fjs.parentNode.insertBefore(js,fjs)})(document,"script","facebook-jssdk");var Brew={game:null,noCursor:false,products:[]};(function(){Brew.Booter=function(){return};Brew.Booter.prototype={preload:function(){WebFont.load({google:{families:["VT323","Press Start 2P"]}});return},update:function(){this.state.add("Preloader",Brew.Preloader,true)}}})();(function(){var game=new Phaser.Game(960,720,Phaser.AUTO,"pienpanimopeli");game.state.add("Booter",Brew.Booter,true);Brew.game=game})();(function(){Brew.Preloader=function(){return};Brew.Preloader.prototype={create:function(){this.state.add("Main",Brew.Main);this.state.add("Menu",Brew.Menu)},preload:function(){this.progress=this.game.add.text(this.game.width/2,this.game.height/2,"Loading: 0 %",{font:'40pt bold "Press Start 2P"',fill:"#FFFFFF"});var _af="assets/";if(typeof BREW_ASSETS_FOLDER!=="undefined")_af=BREW_ASSETS_FOLDER;this.progress.anchor.set(.5);this.progress.fixedToCamera=true;Brew.game.plugins.add(new Phaser.Plugin.Isometric(Brew.game));this.load.atlasJSONHash("sprites",_af+"sprites/brew_sprites.png",_af+"sprites/brew_sprites_data.json");this.load.json("texts",_af+"json/texts.json");this.load.json("tutorial",_af+"json/tutorial.json");this.load.audio("tausta",[_af+"audio/tausta.mp3",_af+"audio/tausta.ogg"]);this.load.audiosprite("sfx",[_af+"audio/sfx.ogg",_af+"audio/sfx.mp3"],_af+"audio/sfx.json");Brew.gui=new Brew.GUI},loadUpdate:function(){this.progress.text="Loading: "+this.load.progress+" %"},update:function(){this.state.start("Menu")}}})();(function(){var credits="Pelin kehittivät:    Mikko Jakonen   Elina Keränen   Anna Näveri    Arttu Seppänen";Brew.Menu=function(){return};Brew.Menu.prototype={create:function(){this.sfx=this.add.audioSprite("sfx");this.logo=this.add.sprite(this.camera.width/2,this.camera.height/2-100,"sprites","logo");this.logo.anchor.set(.5);this.add.tween(this.logo).to({y:this.logo.y+10},2e3,Phaser.Easing.Quadratic.InOut,true,0,-1,true);this.playbutton=this.add.button(this.logo.x,this.logo.y+200,"sprites",this.play,this,"pelaa_over","pelaa_up");this.playbutton.anchor.set(.5);var playButtonRotation=Math.PI/40;this.playbutton.rotation=-playButtonRotation;this.add.tween(this.playbutton).to({rotation:playButtonRotation},3e3,Phaser.Easing.Quadratic.InOut,true,0,-1,true);this.credits=this.add.text(this.camera.width,this.playbutton.y+200,credits,{fill:"#999"});this.credits.font="Press Start 2P";this.credits.fontSize=20;this.add.tween(this.credits).to({x:-2e3},2e4,Phaser.Easing.Linear.None,true,0,-1)},play:function(){this.sfx.play("kilahdus");this.add.tween(this.playbutton).to({y:this.camera.height+50},800,Phaser.Easing.Back.In,true).onComplete.add(function(){this.state.start("Main")},this)}}})();(function(){var settings={tileSize:38};var letter,budget=5e4,lauterer,fermenter,maturer,bottler,storageManager,resourceStorage,floor,spending,text,orderList=[],buyerList=[],buyers,soDirtyEverywhere=0,illegalAds=0;Brew.Main=function(){return};Brew.Main.prototype={create:function(){this.game.iso.anchor.setTo(.5,.3);this.messages=new Brew.Messages;this.isoGroup=this.add.group();this.floor=new Brew.Floor;this.floor.makeFloor(this.game,this.isoGroup);Brew.sfx=this.add.audioSprite("sfx");resourceStorage=new Brew.Storage(this.game,"consumable",this.isoGroup,"");resourceStorage.base.x=4*settings.tileSize;resourceStorage.base.y=8*settings.tileSize;resourceStorage.amount=5;resourceStorage.name="Tarvikkeita";storageManager=new Brew.StorageManager;lauterer=new Brew.Producer(this.game,9*settings.tileSize,8*settings.tileSize,0,"kettle1",this.isoGroup,"Mäskikattila");lauterer.resource=resourceStorage;fermenter=new Brew.Producer(this.game,9*settings.tileSize,5*settings.tileSize,0,"kettle3_with_bubbles",this.isoGroup,"Pääkäymiskattila");maturer=new Brew.Producer(this.game,9*settings.tileSize,2*settings.tileSize,0,"kettle4",this.isoGroup,"Jälkikäymiskattila");bottler=new Brew.Producer(this.game,6*settings.tileSize,2*settings.tileSize,0,"bottlemachine_step",this.isoGroup,"Pullottaja");fermenter.addOption("Tee lageria","lagerbutton","type",Brew.BeerType.LAGER);fermenter.addOption("Tee IPAa","ipabutton","type",Brew.BeerType.IPA);fermenter.addOption("Tee tummaa","darkbutton","type",Brew.BeerType.DARK);maturer.addOption("Pitkä kypsytys","long_brew","taste","Pehmeää");maturer.addOption("Pitkä kypsytys","short_brew","taste","Kitkerää");Brew.Producer.setChain(lauterer,fermenter,maturer,bottler);bottler.onBeerFinished.bind(this.beerFinished,this);var pipes=this.add.isoSprite(8*settings.tileSize,2.8*settings.tileSize,10,"sprites","pipes2",this.isoGroup);pipes.anchor.set(.5,.5);pipes=this.add.isoSprite(8*settings.tileSize,6*settings.tileSize,10,"sprites","pipes",this.isoGroup);pipes.anchor.set(.5,.5);var coin=this.add.button(840,5,"sprites",function(){},this,"moneybar","moneybar");coin.anchor.setTo(.5,0);coin.scale.set(.8,.8);Brew.gui.resources("Osta 1 erä raaka-aineita",this.buyMaterials,this);var seek=this.add.button(910,75,"sprites",function(){Brew.sfx.play("lyhin_kilahdus");var mess=(new Brew.Messages).getMessage();Brew.gui.addMessage("Mainosta",mess.content,null,"✔",function(){this.ad(mess)},this)},this,"seek_button_over","seek_button_out");seek.anchor.setTo(.5,0);var mallas=this.add.button(910,150,"sprites",this.buyMaterials,this,"consumable_button_over","consumable_button_out");mallas.anchor.setTo(.5,0);this.messagesBG=this.add.image(0,20,"sprites","messages_bg");Brew.Budget.create();Brew.Budget.moveProgressBar();Brew.Budget.update(5e4);spending=1e3;text=this.add.text(this.camera.width-62,42,budget,{font:'24px "Press Start 2P"'});text.fill="#FFFFFF";text.align="right";text.anchor.setTo(1,.5);text.number=budget;changeText=this.add.text(this.camera.width-62,65,"",{font:'24px "Press Start 2P"'});changeText.fill="#FFFFFF";changeText.anchor.setTo(1,.5);var walls=this.game.add.isoSprite(.6*settings.tileSize,.6*settings.tileSize,125,"sprites","back_wall_both",this.isoGroup);walls.anchor.setTo(.5,0);var music=this.game.add.audio("tausta");music.loop=true;music.volume=.4;music.play();music.onLoop.add(function(){music.play()},this);this.time.events.loop(Phaser.Timer.SECOND*.5,function(){if(bottler.state==Brew.ProducerState.PROCESSING){bottler.prosessingId++;bottler._sprite.frameName=bottler._frame+bottler.prosessingId%4}},this);var done=this.time.events.loop(Phaser.Timer.SECOND*1,function(){if(storageManager.storages.length==0)return;else{this.initialBuyers();this.time.events.remove(done)}},this);this.time.events.loop(Phaser.Timer.SECOND*20,function(){this.budgetHandling(-spending)},this);this.cleanUp();this.time.events.loop(Phaser.Timer.SECOND*20,function(){this.cleanUp()},this);this.tutorial=new Brew.Tutorial(this.game,this.isoGroup);this.tutorial.lauterer=lauterer;this.tutorial.fermenter=fermenter;this.tutorial.maturer=maturer;this.tutorial.bottler=bottler;this.tutorial.resources=resourceStorage;this.tutorial.start()},cleanUp:function(){var clean=this.add.isoSprite(Brew.game.rnd.integerInRange(0*settings.tileSize,10*settings.tileSize),Brew.game.rnd.integerInRange(0*settings.tileSize,10*settings.tileSize),0,"sprites","dirt",this.isoGroup);clean.anchor.setTo(.5,1);soDirtyEverywhere++;if(soDirtyEverywhere%10==0)Brew.gui.alert("Hygieniasi on epäilyttävää. Sait sakot.",this.budgetHandling(-500),this);clean.inputEnabled=true;var tween=Brew.game.add.tween(clean.scale).to({x:1.1,y:1.1},200,Phaser.Easing.Linear.None,false,0,10,true);clean.events.onInputOver.add(function(){tween.start()});clean.events.onInputDown.add(function(){tween.stop();Brew.game.add.tween(clean.scale).to({x:.1,y:.1},800,Phaser.Easing.Linear.None,true,0,1,true);Brew.sfx.play("swishes");this.time.events.add(Phaser.Timer.SECOND*.8,function(){clean.destroy()});soDirtyEverywhere--},this)},buyMaterials:function(){Brew.sfx.play("lyhin_kilahdus");if(resourceStorage.amount<30){var price=-1e3;this.budgetHandling(price);resourceStorage.amount+=1}else{Brew.gui.alert("Tarvikevarastosi on täynnä!")}},ad:function(mess){this.budgetHandling(-parseInt(mess.due));var warning="";if(mess.title!="Laillinen"){illegalAds++;if(illegalAds==5){Brew.gui.alert("Olet mainostanut liikaa laittomasti. Menetit toimilupasi ja hävisit pelin.");this.gameOver();return}else warning="Tämä on "+illegalAds+". laiton mainos"}else this.createBuyer();Brew.gui.alert(mess.dueText+" "+warning)},gameOver:function(){this.time.events.removeAll()},sendBrag:function(caption,callback){FB.ui({method:"feed",caption:caption,picture:"localhost:8080/pienpanimopeli/assets/sprites/single_sprites/giantcan.png",name:"Testing"},callback)},hire:function(){spending=parseInt(spending)+500;var employee=new Person(Brew.game,Brew.game.rnd.integerInRange(0,9)*settings.tileSize,9*settings.tileSize,10,this.isoGroup,this.floor)},sell:function(order){var storagei;for(i in storageManager.storages){var beerType=storageManager.storages[i].name;if(beerType==order.name)storagei=i}if(storageManager.storages[storagei]==undefined)return false;if(storageManager.storages[storagei].amount<order.amount)return false;else if(order.buyer=="Erkki Virtanen"){this.budgetHandling(-500);Brew.gui.alert("Yksityishenkilölle myyminen on laitonta! Sait sakot.")}else{this.budgetHandling(order.price*order.amount);storageManager.storages[storagei].amount-=order.amount;orderList.splice(order.getIndex(order,orderList),1);Brew.sfx.play("lyhyt_kilahdus")}},beerFinished:function(beer){Brew.sfx.play("lyhyt_kilahdus");storageManager.addBeer(beer,4)},initialBuyers:function(){var initial=(new Order).initialBuyers();for(i in initial){buyerList.push(initial[i]);this.time.events.loop(Phaser.Timer.SECOND*60,this.updateOrders,this,initial[i])}},createBuyer:function(){var order=new Order;var buyer=order.newBuyer();buyerList.push(buyer);this.time.events.loop(Phaser.Timer.SECOND*60,this.updateOrders,this,buyer)},updateOrders:function(buyer){if(buyerList==0){var allListElements=$(".brew-message");allListElements.each(function(index){$(this).remove()});Brew.gui.alert("Menetit kaikki tilaajasi.");this.time.events.removeAll();return}var secondsToDisappear=6e4;orderList.forEach(function(order){if(Brew.game.time.now-order.age>secondsToDisappear){var allListElements=$(".brew-message");allListElements.each(function(index){if($(this).data("messageData")==order){$(this).remove();order.buyers.splice(order.getIndex(order.buyer,buyerList),1);orderList.shift();return}});Brew.gui.alert("Tilaus vanhentui ja tilaaja "+order.buyer+" poistui tilaajalistaltasi.")}});var names=Brew.products;if(names.length<=0)return;if(buyer!=undefined){var order=(new Order).random(buyer,names);orderList.push(order);Brew.gui.addMessage("Tilaus",order.message(),order,"✔",this.sell,this,this.remove);Brew.sfx.play("ding")}},remove:function(order){order.buyers.splice(order.getIndex(order.buyer,buyerList),1);orderList.splice(order.getIndex(order,orderList),1);Brew.gui.alert("Tilaaja "+order.buyer+" poistui tilaajalistaltasi.");if(buyerList==0){var allListElements=$(".brew-message");allListElements.each(function(index){$(this).remove()});Brew.gui.alert("Menetit kaikki tilaajasi.");this.time.events.removeAll();return}},budgetHandling:function(money){budget=budget+money;changeText.setText(money);if(money>=0)changeText.fill="#106906";else changeText.fill="#EE0A0A";this.time.events.add(2e3,function(){changeText.setText("")},this);if(budget<=0){Brew.gui.alert("Menetit kaikki rahasi ja hävisit pelin.");Brew.Budget.update(budget);text.setText(budget);this.gameOver()}else if(budget>=1e5){Brew.gui.alert("Liikevoittosi on ilmiömäinen. Voitit pelin!");Brew.Budget.update(budget);text.setText(budget)}else{Brew.Budget.startBudget(budget,text)}},update:function(){this.game.iso.simpleSort(this.isoGroup);this.messages.update();storageManager.update();resourceStorage.update();if(budget<=1e5&&budget>=0){text.setText(Math.floor(text.number))}else{text.setText(budget)}}};var Order=function(type,amount,buyer,name){this.age=Brew.game.time.now;this.type=type;this.amount=amount;this.buyer=buyer;this.name=name;this.buyers=buyerList;var pieni=1;var suuri=15;this.staticBuyers=[["Alko",suuri],["Kesko",suuri],["S-Ryhmä",suuri],["Musta Kynnys",pieni],["Ale Pub",pieni],["Erkki Virtanen",pieni],["Iso Baari",pieni],["Pub Rousku",pieni],["Oluthuone Rymy",pieni],["Gastropub Lohi",pieni],["Rappiohuone",pieni],["Hilkan pubi",pieni]];this.price=500};Order.prototype.initialBuyers=function(){var buyers=[["Hemingways",1],["Vakiopaine",1]];return buyers};Order.prototype.getIndex=function(object,list){for(var i=0,j=list.length;i<j;i++){if(list[i]===object){return i}}return-1};Order.prototype.newBuyer=function(){var buyer=this.staticBuyers[Brew.game.rnd.integerInRange(0,this.staticBuyers.length)];return buyer};Order.prototype.random=function(buyer,names){var types=["lager","IPA","dark"];var amountType=buyer[1];var amount=Brew.game.rnd.integerInRange(amountType,amountType+5);return new Order(types[Brew.game.rnd.integerInRange(0,types.length-1)],amount,buyer[0],names[Brew.game.rnd.integerInRange(0,names.length-1)])};Order.prototype.message=function(){return this.amount+" koria: "+this.name+" Tilaaja:"+this.buyer};Brew.Order=Order})();(function(){var Messages=function(){};Messages.prototype={update:function(){},getMessage:function(){var data=Brew.game.cache.getJSON("texts");var message=data.ads[Math.floor(Math.random()*data.ads.length)];return message}};Brew.Messages=Messages})();(function(){var settings={dom:"#pienpanimopeli",messagesAnimationSpeed:100,messagesHoverSpeed:100};var GUI=function(){this._messageWindow=$("<div><div/>").addClass("brew-messages").appendTo(settings.dom);this.resourceWindow=null;this.seekWindow=null;this.infoWindows=[]};GUI.prototype.resources=function(message,callback,callbackCtx){this.resourceWindow=$("<div><div/>").addClass("brew-window brew-resources").html(message).append(this.__makeButton("Osta",function(){var p=$(this).parent();p.data("type",Brew.BeerType.LAGER);if(p.data("callback"))p.data("callback").call(p.data("callbackCtx"));p.hide("drop",{direction:"right"},200,"easeInBack",function(){this.remove()})})).appendTo(settings.dom).data("callback",callback).data("callbackCtx",callbackCtx)};GUI.prototype.seek=function(message,callback,callbackCtx){this.seekWindow=$("<div><div/>").addClass("brew-window brew-resources").html(message).append(this.__makeButton("OK",function(){var p=$(this).parent();if(p.data("callback"))p.data("callback").call(p.data("callbackCtx"));p.hide("drop",{direction:"right"},200,"easeInBack",function(){this.remove()})})).appendTo(settings.dom).data("callback",callback).data("callbackCtx",callbackCtx)};GUI.prototype.toggleSeek=function(message,callback,callbackCtx){this.seekWindow.toggle("slide",{direction:"right"},200)};GUI.prototype.toggleResources=function(message,callback,callbackCtx){this.resourceWindow.toggle("slide",{direction:"right"},200)};GUI.prototype.alert=function(message,callback,callbackCtx){$("<div><div/>").addClass("brew-window brew-alert").html(message).append(this.__makeButton("OK",function(){var p=$(this).parent();if(p.data("callback"))p.data("callback").call(p.data("callbackCtx"));p.hide("drop",200,"easeInBack",function(){this.remove()})})).appendTo(settings.dom).show("drop",200,"easeOutBack").data("callback",callback).data("callbackCtx",callbackCtx)};GUI.prototype.showInfo=function(x,y,message){var w=$("<div></div>").addClass("brew-info-window brew-window").appendTo(settings.dom).css({left:x,top:y}).html(message).show({effect:"scale",origin:["left","center"],duration:80});return w};GUI.prototype.hideInfo=function(window){window.hide({effect:"scale",origin:["left","center"],duration:80,complete:function(){$(this).remove()}})};GUI.prototype.showTutorialWindow=function(message,okbuttonCallback,okButtonCallbackContext){var w;w=$("<div></div>").addClass("brew-tutorial-window brew-window").append($("<div></div>").addClass("brew-tutorial-content")).append(this.__makeButton("OK",function(){var p=$(this).parent();if(p.data("callback"))p.data("callback").call(p.data("callbackCtx"))})).data("callback",okbuttonCallback).data("callbackCtx",okButtonCallbackContext).appendTo(settings.dom).show({effect:"slide",duration:100});this._tutorialWindow=w};GUI.prototype.setTutorialWindow=function(message,okbuttonCallback,okButtonCallbackContext){var w=this._tutorialWindow;w.children(".brew-tutorial-content").html(message).append(this.__makeButton("X",function(){var p=$(this).parent();if(p.data("callback"))p.data("callback").call(p.data("callbackCtx"))}).addClass("brew-hidebutton")).data("callback",okbuttonCallback).data("callbackCtx",okButtonCallbackContext)};GUI.prototype.hideTutorialWindow=function(){this._tutorialWindow.hide({effect:"slide",duration:100})};GUI.prototype.query=function(message,callback,callbackCtx){$("<div><div/>").addClass("brew-window brew-alert").html(message).append($("<input/>").attr({type:"text",id:"brew-query"})).append(this.__makeButton("OK",function(){var p=$(this).parent();var answer=p.children("#brew-query").val();if(p.data("callback"))p.data("callback").call(p.data("callbackCtx"),answer);p.hide("drop",200,"easeInBack",function(){this.remove()})})).appendTo(settings.dom).show("drop",200,"easeOutBack").data("callback",callback).data("callbackCtx",callbackCtx)};GUI.prototype.addMessage=function(header,message,data,buttonText,buttonCallback,buttonCallbackCtx,rejectCallback){var _w=$("<div><div/>").addClass("brew-window brew-message").html("<h2>"+header+"<h2>").append($("<div><div/>").addClass("brew-message-body").html(message)).append(this.__makeButton("X",function(){var remove=true;if($(this).data("rejectCallback"))remove=$(this).data("rejectCallback").call($(this).data("callbackCtx"),$(this).parent().data("messageData"));if(remove!==false)$(this).parent().hide("fold",200,"easeInBack",function(){$(this).parent().parent().remove()});else e.stopPropagation()},null,"cancel").data("rejectCallback",rejectCallback).css({display:"none"})).click(this.__messageWindowClicked).hover(this.__messageWindowHover,this.__messageWindowHover).data("messageData",data).appendTo(this._messageWindow);if(buttonText){_w.append(this.__makeButton(buttonText,function(e){var $this=$(this);var remove=true;if($this.data("callback"))remove=$this.data("callback").call($this.data("callbackCtx"),$this.parent().data("messageData"));if(remove!==false)$this.parent().hide("fold",200,"easeInBack",function(){$(this).remove()});else e.stopPropagation()}).css({display:"none","font-size":"12pt"}).data("callback",buttonCallback).data("callbackCtx",buttonCallbackCtx))}};GUI.prototype.toggleMessages=function(){this.__closeOpenMessages();this._messageWindow.toggle("slide",{easing:"easeOutBounce"},200)};GUI.prototype.__shareButton=function(callback){return $("<div></div>").addClass("fb-share-button").data("send",true).data("href","localhost:8080/pienpanimopeli/assets/sprites/single_sprites/bottle.png").data("action",callback).css({margin:"0px","float":"right"}).click(callback)};GUI.prototype.__makeButton=function(text,callback){return $("<div></div>").addClass("brew-button").text(text).click(callback)};GUI.prototype.__messageWindowHover=function(){$(this).toggleClass("brew-message-extended",settings.messagesHoverSpeed)};GUI.prototype.__closeOpenMessages=function(){$(".brew-message-open").each(function(){$(this).toggleClass("brew-message-open",settings.messagesAnimationSpeed,"easeOutBounce");$(this).children(".brew-message-body, .brew-button").toggle("fold",{direction:"up",easing:"easeOutQuad"},settings.messagesAnimationSpeed)})};GUI.prototype.__messageWindowClicked=function(){var $this=$(this);if(!$this.hasClass("brew-message-open")){$(".brew-message-open").each(function(){$(this).toggleClass("brew-message-open",settings.messagesAnimationSpeed,"easeOutBounce");$(this).children(".brew-message-body, .brew-button").toggle("fold",{direction:"up",easing:"easeOutQuad"},settings.messagesAnimationSpeed)})}$this.toggleClass("brew-message-open",settings.messagesAnimationSpeed,"easeOutBounce");$this.children(".brew-message-body, .brew-button").toggle("fold",{direction:"up",easing:"easeOutQuad"},settings.messagesAnimationSpeed)};Brew.GUI=GUI})();(function(){var settings={dom:"#progressbar",progressStyle:{width:"100%",height:"25px"},wrapStyle:{background:"#f80",margin:"10px",overflow:"hidden",position:"relative"},barStyle:{background:"#ddd",left:"0",position:"absolute",top:"0"}};var div;var bar;var full=1e5;var tween;var Budget=function(){};Budget.prototype.startBudget=function(budget,text){this.tween=Brew.game.add.tween(text).to({number:budget},1e3,Phaser.Easing.Linear.None,true);this.update(budget)};Budget.prototype.update=function(money){var percent=money/1e3;var message;if(percent<=0){percent=0;this.tween.stop()}else if(percent>=100){percent=100;this.tween.stop()}else message="";div.data("percent",percent);this.moveProgressBar();return message};Budget.prototype.moveProgressBar=function(){var getPercent=div.data("percent")/100;var getProgressWrapWidth=div.width();var progressTotal=getPercent*getProgressWrapWidth;var animationLength=250;bar.stop().animate({left:progressTotal},animationLength)};Budget.prototype.create=function(){bar=$("<div>").css(settings.progressStyle).css(settings.barStyle);div=$("<div>").css(settings.progressStyle).css(settings.wrapStyle).data("percent",100).append(bar).appendTo(settings.dom)};Brew.Budget=new Budget})();(function(){Brew.BeerType={LAGER:0,IPA:1,DARK:2};Brew.BeerTypeDescriptions=["lageria","ipaa","tummaa olutta"];Brew.BeerSprites=["lager_case","porter_case","dark_case"];var Beer=function(type,taste){var _type=type?type:Brew.BeerType.LAGER;var _taste=taste?taste:"pehmeää";this.type=_type;this.taste=_taste};Beer.prototype.constructor=Beer;Beer.prototype.getSprite=function(){return Brew.BeerSprites[this.type]};Object.defineProperty(Beer.prototype,"id",{get:function(){return""+this.type}});Object.defineProperty(Beer.prototype,"description",{get:function(){return this.taste+" "+Brew.BeerTypeDescriptions[this.type]}});Brew.Beer=Beer})();(function(){var settings={tileWidth:38,caseHeight:18,pileHeight:5,pileWidth:3,caseValue:1};var Storage=function(game,spriteName,group,description,type){this._game=game;this._group=group;this._frame=spriteName;this._frameSelected=spriteName+"_selected";this._amount=0;this._cases=[];this._current={x:0,y:0,z:0};this.name="Nimetön";this.base={x:0,y:0,z:0};this.description=description;this.type=type};Storage.prototype.constructor=Storage;Storage.prototype.addCase=function(){var _case=this._game.add.isoSprite(0,0,0,"sprites",this._frame,this._group);_case.anchor.set(.5,.76);_case.isoX=this.base.x+settings.tileWidth*this._current.x;_case.isoY=this.base.y+settings.tileWidth*this._current.y;_case.isoZ=this.base.z+settings.caseHeight*this._current.z;_case.inputEnabled=true;_case.events.onInputOver.add(function(){this._mouseOver=true},_case);_case.events.onInputOut.add(function(){this._mouseOver=false},_case);_case.casePosition={x:this._current.x,y:this._current.y,z:this._current.z};if(++this._current.z>=settings.pileHeight){if(++this._current.x>=settings.pileWidth){this._current.y++;this._current.x=0}this._current.z=0}this._cases.push(_case)};Storage.prototype.removeCase=function(){var _case=this._cases.pop();this._current.x=_case.casePosition.x;this._current.y=_case.casePosition.y;this._current.z=_case.casePosition.z;_case.destroy()};Storage.prototype.moveEmployee=function(){Brew.game.add.tween(Brew.Person).to({isoX:this._current.x+130,isoY:this._current.y,isoZ:0},2e3,Phaser.Easing.Linear.None,true,0,0,false)};Storage.prototype.update=function(){var _mouse=false;for(var i=0;i<this._cases.length;i++){if(this._cases[i]._mouseOver){_mouse=true;break}}if(_mouse&&!this._selected){this._selected=true;for(var j=0;j<this._cases.length;j++){this._cases[j].frameName=this._frameSelected}var infoPosition=this._game.iso.project(new Phaser.Plugin.Isometric.Point3(this.base.x+settings.tileWidth*1,this.base.y+settings.tileWidth*1,this.base.z+settings.tileWidth*settings.pileHeight));this._info=Brew.gui.showInfo(infoPosition.x-100,infoPosition.y+50,"<b>"+this.name+":</b> "+this.amount+"<br />"+this.description)}if(!_mouse&&this._selected){this._selected=false;for(var k=0;k<this._cases.length;k++){this._cases[k].frameName=this._frame}Brew.gui.hideInfo(this._info)}};Object.defineProperty(Storage.prototype,"amount",{get:function(){return this._amount},set:function(newAmount){var caseDifference=Math.floor(newAmount/settings.caseValue)-this._cases.length;if(caseDifference<0)for(var i=caseDifference;i<0;i++)this.removeCase();else for(var j=0;j<caseDifference;j++)this.addCase();this._amount=newAmount}});Object.defineProperty(Storage.prototype,"isoPosition",{get:function(){return this.base}});Brew.Storage=Storage})();(function(){var settings={tileSize:38};var graph=[[0,0,1,1,1,1,1,1,1,1],[0,0,1,1,0,0,1,0,0,1],[1,1,1,1,0,0,1,0,0,1],[0,0,1,1,1,1,1,1,1,1],[0,0,1,1,1,1,1,0,0,1],[1,1,1,1,1,1,1,0,0,1],[0,0,1,1,1,1,1,1,1,1],[0,0,1,1,1,1,1,0,0,1],[1,1,1,1,0,0,0,0,0,1],[0,0,1,1,0,0,0,1,1,1]];var Floor=function(){};Floor.prototype.makeFloor=function(game,isoGroup){var tile;for(var xx=0;xx<10*settings.tileSize;xx+=settings.tileSize){for(var yy=0;yy<10*settings.tileSize;yy+=settings.tileSize){tile=game.add.isoSprite(xx,yy,0,"sprites","floor",isoGroup);tile.anchor.set(.5,.5)}}};Floor.prototype.setElement=function(element){graph[Math.floor(element.isoX/settings.tileSize)][Math.floor(element.isoY/settings.tileSize)]=0;this.grid=easystar.setGrid(graph)};Brew.Floor=Floor})();(function(){Brew.ProducerState={IDLE:0,PROCESSING:1,DONE:2};var STATE_ICONS=["producer_idle","producer_active","producer_done"];var Producer=function(game,x,y,z,frame,group,name){this.name=name;this._sprite=game.add.isoSprite(x,y,z,"sprites",frame,group);this._game=game;this._state=Brew.ProducerState.IDLE;this.next=null;this.previous=null;this.beer=null;this.resource=null;this.isFinal=false;this.workDuration=20;this.optionOffset={x:-30,y:-70};this.onClick=new Phaser.Signal;this.prosessingId=0;this._frameProsessing=frame+this.prosessingId;this.onBeerFinished={bind:function(callback,ctx){this._callback=callback;this._ctx=ctx},fire:function(arg){if(this._callback)this._callback.call(this._ctx,arg)}};this._selectedOption=0;this._options=[];this._frame=frame;this._frameSelected=frame+"_selected";this._sprite.anchor.setTo(.5,.97);this._sprite.inputEnabled=true;this._sprite.events.onInputDown.add(this._inputDown,this);this._sprite.events.onInputOver.add(this._inputOver,this);this._sprite.events.onInputOut.add(this._inputOut,this);this._sprite.input.pixelPerfectClick=true;this._sprite.input.pixelPerfectOver=true};Producer.prototype.constructor=Producer;Producer.prototype.begin=function(from){var beer;if(from){beer=from.beer;from.end()}else{beer=new Brew.Beer}if(this.resource){this.resource.amount-=1;Brew.sfx.play("bubbling")}this.beer=beer;if(this.currentOption)beer[this.currentOption._parameter]=this.currentOption._value;var workTween=this._game.add.tween(this._sprite.scale).to({x:1.02,y:1.02},100,Phaser.Easing.Linear.None,true,0,this.workDuration,true);workTween.onComplete.add(function(){this.state=Brew.ProducerState.DONE;if(!this.next){this.onBeerFinished.fire(this.beer);this.end()}else{this.next.begin(this)}},this);this.state=Brew.ProducerState.PROCESSING};Producer.prototype.end=function(){this.state=Brew.ProducerState.IDLE;this.beer=null;this._sprite.frameName=this._frame};Producer.prototype.addOption=function(name,sprite,parameter,value){var option=this._game.add.sprite(this._sprite.x+this.optionOffset.x,this._sprite.y+this.optionOffset.y,"sprites",sprite+"_over");if(this._options.length>0)option.frameName=sprite+"_out";option.visible=false;option._parameter=parameter;option._value=value;option._sprite=sprite;this._options.push(option)};Object.defineProperty(Producer.prototype,"state",{get:function(){return this._state},set:function(newState){this._state=newState}});Object.defineProperty(Producer.prototype,"selectedOption",{get:function(){return this._selectedOption},set:function(newOptionNum){var oldOption=this._options[this._selectedOption];var newOption=this._options[newOptionNum];oldOption.frameName=oldOption._sprite+"_out";newOption.frameName=newOption._sprite+"_over";this._selectedOption=newOptionNum}});Object.defineProperty(Producer.prototype,"currentOption",{get:function(){return this._options[this.selectedOption]}});Object.defineProperty(Producer.prototype,"isoPosition",{get:function(){return this._sprite.isoPosition}});Producer.prototype._inputDown=function(){if(this.state==Brew.ProducerState.IDLE){if(!this.previous){this.begin()}}if(this._options.length>0){if(this.selectedOption>=this._options.length-1)this.selectedOption=0;else this.selectedOption=this.selectedOption+1}this.onClick.dispatch();Brew.gui.hideInfo(this._info)};Producer.prototype._inputOver=function(){this._sprite.frameName=this._frameSelected;var theta=0;var r=40;var toX,toY;var option;for(var i=0;i<this._options.length;i++){option=this._options[i];option.visible=true;theta=i*(Math.PI*2*(1/6));toX=this._sprite.x+this.optionOffset.x+r*Math.cos(theta);toY=this._sprite.y+this.optionOffset.y+r*Math.sin(theta);this._game.add.tween(option).to({x:toX,y:toY},300,Phaser.Easing.Cubic.Out,true)}this._info=Brew.gui.showInfo(this._sprite.x-50,this._sprite.y+15,this.name)};Producer.prototype._inputOut=function(){this._sprite.frameName=this._frame;for(var i=0;i<this._options.length;i++){var option=this._options[i];option.visible=false;option.x=this._sprite.x+this.optionOffset.x;option.y=this._sprite.y+this.optionOffset.y}Brew.gui.hideInfo(this._info)};Producer.setChain=function(){for(var i=0;i<arguments.length;i++){arguments[i].previous=arguments[i-1];arguments[i].next=arguments[i+1]}};Brew.Producer=Producer})();(function(){var settings={tileSize:38};var StorageManager=function(){this.storages=[];this.base={x:0,y:0,z:0}};StorageManager.prototype.constructor=StorageManager;StorageManager.prototype.addBeer=function(beer,amount){if(!this.storages[beer.id])this.newStorage(beer);this.storages[beer.id].amount+=amount};StorageManager.prototype.newStorage=function(beer){var _storage=new Brew.Storage(Brew.game,beer.getSprite(),this._group,beer.description,beer.type);_storage.base={x:this.base.x,y:this.base.y,z:this.base.z};this.base.y+=2*settings.tileSize;this.storages[beer.id]=_storage;this._naming=beer;Brew.gui.query("Olet kehittänyt uudenlaisen oluen! Tuottamasi olut on <b>**"+beer.description+"**</b>! <br /><br />Anna tuotteelle nimi:",function(ans){ans.replace(/</g,"&lt;").replace(/>/g,"&gt;");var name=ans.replace(/</g,"&lt;").replace(/>/g,"&gt;")?ans.replace(/</g,"&lt;").replace(/>/g,"&gt;"):this._naming.description;this.storages[this._naming.id].name=name;Brew.products.push(name)},this)};StorageManager.prototype.update=function(){for(var i in this.storages){this.storages[i].update()}};Brew.StorageManager=StorageManager})();(function(){Brew.Tutorial=function(game){this.game=game;this.group=game.add.group();this.texts=game.cache.getJSON("tutorial").tutorial;this.current=-1};Brew.Tutorial.prototype={start:function(){this.current=-1;Brew.gui.showTutorialWindow("",function(){this.next()},this);this.next()},point:function(x,y,z){var arrow=this.game.add.isoSprite(x,y,z+190,"sprites","arrow",this.group);arrow.anchor.set(.5,.5);this.game.add.tween(arrow).to({isoZ:z+180},300,Phaser.Easing.Linear.None,true,0,-1,true)},next:function(){this.group.destroy();this.group=this.game.add.group();if(++this.current>=this.texts.length){Brew.gui.hideTutorialWindow();return}for(var i in this.texts[this.current].point){var elem=this[this.texts[this.current].point[i]];var pos=elem.isoPosition;this.point(pos.x,pos.y,pos.z)}Brew.gui.setTutorialWindow(this.texts[this.current].text,this.stop,this)},update:function(){},stop:function(){this.group.destroy();Brew.gui.hideTutorialWindow();
}}})();