var Brew={game:null};(function(){Brew.Booter=function(){return};Brew.Booter.prototype={preload:function(){return},update:function(){this.state.add("Preloader",Brew.Preloader,true)}}})();(function(){var game=new Phaser.Game(960,720,Phaser.AUTO,"game");game.state.add("Booter",Brew.Booter,true);Brew.game=game})();(function(){Brew.Preloader=function(){return};Brew.Preloader.prototype={create:function(){this.state.add("Main",Brew.Main)},preload:function(){this.progress=this.game.add.text(this.game.width/2,this.game.height/2,"Ladataan: 0 %",{font:"40pt bold Arial",fill:"#FFFFFF"});this.progress.anchor.set(.5);this.progress.fixedToCamera=true;this.load.image("floor","assets/sprites/floor.png");this.load.image("cursor","assets/sprites/select.png");Brew.game.plugins.add(new Phaser.Plugin.Isometric(Brew.game));this.load.image("letter","assets/sprites/letter.png")},loadUpdate:function(){this.progress.text="Loading: "+this.load.progress+" %"},update:function(){this.state.start("Main")}}})();(function(){var settings={tileSize:38};var letter,scoreText,output,timer,counter=0,sakot,i=0;Brew.Main=function(){return};Brew.Main.prototype={create:function(){this.isoGroup=this.add.group();this.__makeFloor();this.cursorPosition=this.cursor=this.add.isoSprite(0,0,0,"cursor",0,this.isoGroup);letter=this.add.sprite(this.width,this.height,"letter");letter.scale.set(.2,.2);letter.anchor.setTo(0,0);letter.inputEnabled=true;letter.inputEnabled=true;letter.input.start();scoreText=this.add.text(this.world.centerX+300,this.world.height/5,"",{size:"32px",fill:"#FFF",align:"center"});scoreText.anchor.set(.5);scoreText.setText("Seconds");timer=this.time.create(false);timer.loop(Phaser.Timer.SECOND,this.updateCounter,this);timer.start();$.getJSON("src/core/texts.json",function(data){sakot=data.letters[0].content});$.getJSON("src/core/texts.json",function(data){output=data.order[Math.floor(Math.random()*data.order.length)].content});this.moveProgressBar(1)},moveProgressBar:function(jako){console.log("moveProgressBar");var getPercent=$(".progress-wrap").data("progress-percent")/jako;var getProgressWrapWidth=$(".progress-wrap").width();var progressTotal=getPercent*getProgressWrapWidth;var animationLength=250;$(".progress-bar").stop().animate({left:progressTotal},animationLength)},updateCounter:function(){counter++;if(counter<5){scoreText.setText(counter)}else{var tilaus=$.getJSON("src/core/texts.json",function(data){output=data.order[Math.floor(Math.random()*data.order.length)].content});Brew.gui.newOrder(output);var list=[];list[i]=tilaus;i++;if(list.length>3){Brew.gui.alert(sakot);timer.pause()}console.log(list.length);counter=0}},update:function(){this.moveProgressBar(counter*10);$(window).resize(function(){moveProgressBar()});if(letter.input.pointerDown(this.game.input.activePointer.id)){Brew.gui.alert("klikkasit kirjettä")}var _pos=new Phaser.Plugin.Isometric.Point3;this.game.iso.unproject(this.game.input.activePointer.position,_pos);this.isoGroup.forEach(function(tile){var inBounds=tile.isoBounds.containsXY(_pos.x,_pos.y);if(inBounds){this.cursor.isoX=tile.isoX;this.cursor.isoY=tile.isoY}},this)},__makeFloor:function(){var tile;for(var xx=0;xx<15*settings.tileSize;xx+=settings.tileSize){for(var yy=0;yy<15*settings.tileSize;yy+=settings.tileSize){tile=this.add.isoSprite(xx,yy,0,"floor",0,this.isoGroup)}}}}})();(function(){var settings={dom:"#game",alertStyle:{font:"20pt",background:"white",width:"400px",padding:"10px",border:"#20c55f 3px solid",margin:"auto",position:"relative",top:"-360px",display:"none"},letterStyle:{position:"relative",display:"none"},buttonStyle:{font:"20pt ",width:"50px",margin:"auto",background:"#20c55f","text-align":"center",color:"white",cursor:"pointer"}};var GUI=function(){this._guiInUse=false};GUI.prototype.alert=function(message,callback,callbackCtx){if(this._guiInUse)return;this._guiInUse=true;this._currentWindow=$("<div><div/>").css(settings.alertStyle).html(message).append(this.__makeButton("OPEN",this.__openPressed,this)).appendTo(settings.dom).show("bounce",{times:3});this._okCallback=callback;this._okCallbackCtx=callbackCtx};GUI.prototype.newOrder=function(message,callback,callbackCtx){this._currentWindow=$("<div><div/>").css(settings.alertStyle).html(message).append(this.__makeButton("OK",this.__okPressed,this)).appendTo(settings.dom).show("bounce",{times:3});this._okCallback=callback;this._okCallbackCtx=callbackCtx};GUI.prototype.__openPressed=function(){this._currentWindow=$("<div><div/>").css(settings.alertStyle).html("tekstiä").append(this.__makeButton("OK",this.__okPressed,this)).appendTo(settings.dom).show("bounce",{times:3})};GUI.prototype.__makeButton=function(text,callback,callbackCtx){return $("<div></div>").css(settings.buttonStyle).text(text).click($.proxy(callback,callbackCtx))};GUI.prototype.__okPressed=function(){this._currentWindow.hide("puff",{percent:110},"fast");this._guiInUse=false;if(this._okCallback)this._okCallback.call(this._okCallbackCtx)};Brew.GUI=GUI;Brew.gui=new GUI})();