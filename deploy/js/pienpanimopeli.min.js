var Brew={game:null,noCursor:false};(function(){Brew.Booter=function(){return};Brew.Booter.prototype={preload:function(){WebFont.load({google:{families:["VT323","Press Start 2P"]}});console.log("BOOT: Web fonts loaded.");return},update:function(){this.state.add("Preloader",Brew.Preloader,true)}}})();(function(){var game=new Phaser.Game(960,720,Phaser.AUTO,"game");game.state.add("Booter",Brew.Booter,true);Brew.game=game})();(function(){Brew.Preloader=function(){return};Brew.Preloader.prototype={create:function(){this.state.add("Main",Brew.Main)},preload:function(){this.progress=this.game.add.text(this.game.width/2,this.game.height/2,"Loading: 0 %",{font:'40pt bold "Press Start 2P"',fill:"#FFFFFF"});this.progress.anchor.set(.5);this.progress.fixedToCamera=true;Brew.game.plugins.add(new Phaser.Plugin.Isometric(Brew.game));this.load.atlasJSONHash("sprites","assets/sprites/brew_sprites.png","assets/sprites/brew_sprites_data.json");this.load.json("texts","assets/json/texts.json");console.log("PRELOAD: Images loaded");Brew.gui=new Brew.GUI;console.log("PRELOAD: GUI initialized")},loadUpdate:function(){this.progress.text="Loading: "+this.load.progress+" %"},update:function(){this.state.start("Main")}}})();(function(){var settings={tileSize:38};var letter,scoreText,output,counter=0,sakot,i=0,budget=50,money,sale,kettle,bottle,storage,lager;Brew.Main=function(){return};Brew.Main.prototype={create:function(){this.game.iso.anchor.setTo(.5,.2);this.messages=new Brew.Messages;this.isoGroup=this.add.group();this.__makeFloor();storage=new Brew.Storage(this.game,this.isoGroup);storage.base.x=0*settings.tileSize;storage.base.y=1*settings.tileSize;storage.amount=10;this.cursor=this.add.isoSprite(0,0,0,"sprites","select",this.isoGroup);this.cursor.anchor.setTo(.5,0);letter=this.add.button(50,5,"sprites",function(){Brew.gui.toggleMessages()},this,"letter_open","letter","letter_open","letter_open");letter.anchor.setTo(.5,0);this.time.events.loop(Phaser.Timer.SECOND*5,this.updateCounter,this);kettle=new Kettle(this.game,3*settings.tileSize+10,3*settings.tileSize-6,0,this.isoGroup);Brew.Budget.create();Brew.Budget.moveProgressBar();Brew.Budget.update(50);var iso=new Order("lageria",200,"Kesko");var pieni=new Order("lageria",1,"Hemingways");var laiton=new Order("lageria",1,"Nalle");Brew.gui.addMessage("Tilaus",iso.message(),iso,"Myy",this.sell);Brew.gui.addMessage("Tilaus",laiton.message(),laiton,"Myy",this.sell);Brew.gui.addMessage("Tilaus",pieni.message(),pieni,"Myy",this.sell)},sell:function(order){if(storage.amount<order.amount)return false;else if(order.buyer=="Nalle"){Brew.gui.alert("Yksityishenkilölle myyminen on laitonta! Sait sakot.");budget=budget-10;Brew.Budget.update(budget)}else{budget=budget+order.price*order.amount;var message=Brew.Budget.update(budget);storage.amount-=order.amount;if(budget>=100){Brew.gui.alert("Liikevoittosi on ilmiömäinen. "+message);kettle.inputEnabled=false}}},updateCounter:function(){var order=(new Order).random();var list=[];list[i++]=Brew.gui.addMessage("Tilaus",order.message(),order,"Myy",this.sell);var now=this.time.totalElapsedSeconds();if(now-order.age>10){}},update:function(){this.game.iso.topologicalSort(this.isoGroup);this.messages.update();var _pos=new Phaser.Plugin.Isometric.Point3;this.game.iso.unproject(this.game.input.activePointer.position,_pos);if(Brew.noCursor){this.cursor.isoX=this.cursor.isoY=-1e3;return}this.isoGroup.forEach(function(tile){var inBounds=tile.isoBounds.containsXY(_pos.x,_pos.y);if(inBounds){this.cursor.isoX=tile.isoX;this.cursor.isoY=tile.isoY}},this)},__makeFloor:function(){var tile;for(var xx=0;xx<10*settings.tileSize;xx+=settings.tileSize){for(var yy=0;yy<10*settings.tileSize;yy+=settings.tileSize){tile=this.add.isoSprite(xx,yy,0,"sprites","floor",this.isoGroup);tile.anchor.set(.5,0)}}}};var Kettle=function(game,x,y,z,group){Phaser.Plugin.Isometric.IsoSprite.call(this,game,x,y,z,"sprites","kettle",group);this.inputEnabled=true;this.events.onInputDown.add(this.check,this);this.events.onInputOver.add(function(){this.frameName="kettle_selected";Brew.noCursor=true},this);this.events.onInputOut.add(function(){this.frameName="kettle";Brew.noCursor=false},this);this.name="kettle";game.add.existing(this)};Kettle.prototype=Object.create(Phaser.Plugin.Isometric.IsoSprite.prototype);Kettle.prototype.constructor=Kettle;Kettle.prototype.check=function(){if(budget-1<=0){Brew.gui.alert("Rahasi eivät riitä uuden erän valmistamiseen.")}else{budget=budget-1;var message=Brew.Budget.update(budget);this.inputEnabled=false;Brew.game.time.events.add(Phaser.Timer.SECOND*4,this.cook,this);Brew.game.add.tween(this).to({isoZ:this.isoZ+2},Phaser.Timer.SECOND/8,Phaser.Easing.Default,true,0,16,true)}};Kettle.prototype.cook=function(){storage.amount+=10;this.inputEnabled=true;if(storage.amount>=50){budget=budget-30;var message=Brew.Budget.update(budget);Brew.gui.alert("Ylitit vuosittaisen tuotantokiintiösi ja sait sakot! "+message)}};Brew.Kettle=Kettle;var Order=function(type,amount,buyer){this.type=type;this.amount=amount;this.price=2;this.buyer=buyer};Order.prototype.random=function(){var types=["lageria","tummaa olutta","portteria"];var buyers=["Kesko","Hemingways","Vakiopaine","Musta Kynnys","Ale Pub","S-Ryhmä","Nalle"];return new Order(types[Brew.game.rnd.integerInRange(0,types.length-1)],Brew.game.rnd.integerInRange(1,10),buyers[Brew.game.rnd.integerInRange(0,buyers.length-1)])};Order.prototype.message=function(){return this.amount+" tynnyriä "+this.type+" Tilaaja:"+this.buyer};Brew.Order=Order})();(function(){var Messages=function(){};var sakot;Messages.prototype={update:function(){},getMessage:function(){var data=Brew.game.cache.getJSON("texts");sakot=data.letters[0].content;return sakot}};Brew.Messages=Messages})();(function(){var Beer=function(){};var price;var name;var amount;var time;Beer.prototype={update:function(){},getBeer:function(){return this.name},sell:function(litres){this.amount=this.amount-litres},cook:function(litres){this.amount=this.amount+litres}};Brew.Beer=Beer})();(function(){var settings={dom:"#game",messagesAnimationSpeed:100,messagesHoverSpeed:100};var GUI=function(){this._messageWindow=$("<div><div/>").addClass("brew-messages").appendTo(settings.dom)};GUI.prototype.alert=function(message,callback,callbackCtx){$("<div><div/>").addClass("brew-window brew-alert").html(message).append(this.__makeButton("OK",function(){var p=$(this).parent();if(p.data("callback"))p.data("callback").call(p.data("callbackCtx"));p.hide("drop",200,"easeInBack",function(){this.remove()})})).appendTo(settings.dom).show("drop",200,"easeOutBack").data("callback",callback).data("callbackCtx",callbackCtx)};GUI.prototype.addMessage=function(header,message,data,buttonText,buttonCallback,buttonCallbackCtx){var _w=$("<div><div/>").addClass("brew-window brew-message").html("<h2>"+header+"<h2>").append($("<div><div/>").addClass("brew-message-body brew-window").html(message)).click(this.__messageWindowClicked).hover(this.__messageWindowHover,this.__messageWindowHover).data("messageData",data).appendTo(this._messageWindow);if(buttonText){_w.append(this.__makeButton(buttonText,function(e){var $this=$(this);var remove=true;if($this.data("callback"))remove=$this.data("callback").call($this.data("callbackCtx"),$this.parent().data("messageData"));if(remove!==false)$this.parent().hide("fold",200,"easeInBack",function(){$(this).remove()});else e.stopPropagation()}).css({display:"none"}).data("callback",buttonCallback).data("callbackCtx",buttonCallbackCtx))}};GUI.prototype.toggleMessages=function(){this.__closeOpenMessages();this._messageWindow.toggle("slide",{easing:"easeOutBounce"},200)};GUI.prototype.__makeButton=function(text,callback){return $("<div></div>").addClass("brew-button").addClass("jotain").text(text).click(callback)};GUI.prototype.__messageWindowHover=function(){$(this).toggleClass("brew-message-extended",settings.messagesHoverSpeed)};GUI.prototype.__closeOpenMessages=function(){$(".brew-message-open").each(function(){$(this).toggleClass("brew-message-open",settings.messagesAnimationSpeed,"easeOutBounce");$(this).children(".brew-message-body, .brew-button").toggle("fold",{direction:"up",easing:"easeOutQuad"},settings.messagesAnimationSpeed)})};GUI.prototype.__messageWindowClicked=function(){var $this=$(this);if(!$this.hasClass("brew-message-open")){$(".brew-message-open").each(function(){$(this).toggleClass("brew-message-open",settings.messagesAnimationSpeed,"easeOutBounce");$(this).children(".brew-message-body, .brew-button").toggle("fold",{direction:"up",easing:"easeOutQuad"},settings.messagesAnimationSpeed)})}$this.toggleClass("brew-message-open",settings.messagesAnimationSpeed,"easeOutBounce");$this.children(".brew-message-body, .brew-button").toggle("fold",{direction:"up",easing:"easeOutQuad"},settings.messagesAnimationSpeed)};Brew.GUI=GUI})();(function(){var settings={dom:"#progressbar",progressStyle:{width:"100%",height:"25px"},wrapStyle:{background:"#f80",margin:"10px",overflow:"hidden",position:"relative"},barStyle:{background:"#ddd",left:"0",position:"absolute",top:"0"}};var money=100;var div;var bar;var Budget=function(){};Budget.prototype.update=function(percent){var message;if(percent<=0){percent=0;message="Menetit kaikki rahasi ja hävisit pelin."}else if(percent>=100){percent=100;message="Voitit pelin!"}else message="";div.data("percent",percent);this.moveProgressBar();return message};Budget.prototype.moveProgressBar=function(){var getPercent=div.data("percent")/100;var getProgressWrapWidth=div.width();var progressTotal=getPercent*getProgressWrapWidth;var animationLength=250;bar.stop().animate({left:progressTotal},animationLength)};Budget.prototype.create=function(){bar=$("<div>").css(settings.progressStyle).css(settings.barStyle);div=$("<div>").css(settings.progressStyle).css(settings.wrapStyle).data("percent",100).append(bar).appendTo(settings.dom)};Brew.Budget=new Budget})();(function(){var settings={tileWidth:38,caseHeight:20,pileHeight:5,pileWidth:4,caseValue:1};var Storage=function(game,group){this._game=game;this._group=group;this._amount=0;this._cases=[];this._current={x:0,y:0,z:0}};Storage.prototype.base={x:0,y:0,z:0};Storage.prototype.addCase=function(){var _case=this._game.add.isoSprite(0,0,0,"sprites","kori",this._group);_case.isoX=this.base.x+settings.tileWidth*this._current.x;_case.isoY=this.base.y+settings.tileWidth*this._current.y;_case.isoZ=this.base.z+settings.caseHeight*this._current.z;_case.casePosition={x:this._current.x,y:this._current.y,z:this._current.z};if(++this._current.z>=settings.pileHeight){if(++this._current.x>=settings.pileWidth){this._current.y++;this._current.x=0}this._current.z=0}this._cases.push(_case)};Storage.prototype.removeCase=function(){var _case=this._cases.pop();this._current.x=_case.casePosition.x;this._current.y=_case.casePosition.y;this._current.z=_case.casePosition.z;_case.destroy()};Object.defineProperty(Storage.prototype,"amount",{get:function(){return this._amount},set:function(newAmount){var oldAmount=this._amount;var caseDifference=Math.floor(newAmount/settings.caseValue)-this._cases.length;if(caseDifference<0)for(var i=caseDifference;i<0;i++)this.removeCase();else for(var i=0;i<caseDifference;i++)this.addCase();this._amount=newAmount}});Brew.Storage=Storage})();