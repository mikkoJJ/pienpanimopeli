var Brew={game:null};(function(){Brew.Booter=function(){return};Brew.Booter.prototype={preload:function(){WebFont.load({google:{families:["VT323","Press Start 2P"]}});console.log("BOOT: Web fonts loaded.");return},update:function(){this.state.add("Preloader",Brew.Preloader,true)}}})();(function(){var game=new Phaser.Game(960,720,Phaser.AUTO,"game");game.state.add("Booter",Brew.Booter,true);Brew.game=game})();(function(){Brew.Preloader=function(){return};Brew.Preloader.prototype={create:function(){this.state.add("Main",Brew.Main)},preload:function(){this.progress=this.game.add.text(this.game.width/2,this.game.height/2,"Loading: 0 %",{font:'40pt bold "Press Start 2P"',fill:"#FFFFFF"});this.progress.anchor.set(.5);this.progress.fixedToCamera=true;Brew.game.plugins.add(new Phaser.Plugin.Isometric(Brew.game));this.load.image("floor","assets/sprites/floor.png");this.load.image("cursor","assets/sprites/select.png");this.load.image("bottle","assets/sprites/bottle.png");this.load.json("texts","assets/json/texts.json");this.load.image("letter","assets/sprites/letter.png");this.load.image("sell","assets/sprites/sell.png");this.load.image("cook","assets/sprites/cook.png");console.log("PRELOAD: Images loaded");Brew.gui=new Brew.GUI;console.log("PRELOAD: GUI initialized")},loadUpdate:function(){this.progress.text="Loading: "+this.load.progress+" %"},update:function(){this.state.start("Main")}}})();(function(){var settings={tileSize:38};var letter,scoreText,output,counter=0,sakot,i=0,budget=50,money,sale,kettle,bottle,storage;Brew.Main=function(){return};Brew.Main.prototype={create:function(){this.messages=new Brew.Messages;this.beer=new Brew.Beer;this.isoGroup=this.add.group();this.__makeFloor();storage=this.add.group();this.cursorPosition=this.cursor=this.add.isoSprite(0,0,0,"cursor",0,this.isoGroup);letter=this.add.button(this.width,this.height,"letter",function(){Brew.gui.toggleMessages()},this);letter.scale.set(.2,.2);letter.anchor.setTo(0,0);scoreText=this.add.text(this.world.centerX+300,this.world.height/5,"",{size:"32px",fill:"#FFF",align:"center"});scoreText.anchor.set(.5);scoreText.setText("Beer in storage: ");this.time.events.loop(Phaser.Timer.SECOND,this.updateCounter,this);lager=this.beer;lager.name="lager";lager.amount=50;sale=this.add.isoSprite(150,100,0,"sell");sale.inputEnabled=true;sale.events.onInputDown.add(this.sell,this);sale.beer=this.beer;kettle=this.add.isoSprite(250,100,0,"cook");kettle.inputEnabled=true;kettle.events.onInputDown.add(this.cook,this);Brew.Budget.create();Brew.Budget.moveProgressBar();Brew.Budget.update(50);bottle=this.add.isoSprite(0,0,0,"bottle");bottle.moves=true;bottle.inputEnabled=true;bottle.input.enableDrag(false,true);storage.add(bottle);Brew.gui.addMessage("Tilaus","3 tynnyriä tummaa olutta.");Brew.gui.addMessage("Tilaus","3 tynnyriä lageria.");Brew.gui.addMessage("Sakko","Myit liikaa olutta!");Brew.gui.addMessage("Viesti","Haluan ostaa olutta! t: Nalle")},sell:function(){if(storage.length<=0)return;else{var message=Brew.Budget.update(budget+10);budget=budget+10;sale.beer.sell(10);if(budget>=100){Brew.gui.alert("Liikevoittosi on ilmiömäinen. "+message)}storage.getFirstExists(true).destroy()}},cook:function(){if(storage.length>=15){budget=budget-50;var message=Brew.Budget.update(budget);Brew.gui.alert("Ylitit vuosittaisen tuotantokiintiösi ja sait sakot! "+message)}else{budget=budget-1;var message=Brew.Budget.update(budget);sale.beer.cook(10);if(budget<=0){kettle.inputEnabled=false;Brew.gui.alert(message)}var b=this.add.isoSprite(0,this.game.rnd.integerInRange(0,500),0,"bottle");b.inputEnabled=true;b.input.enableDrag(false,true);storage.add(b)}},updateCounter:function(){counter++;if(counter<5){scoreText.setText(counter)}else{output=this.messages.getMessage();var list=[];list[i]=this.messages.getMessage();i++;if(list.length>1){}counter=0}},update:function(){scoreText.setText("Beer in storage: "+this.beer.amount+" litres");this.messages.update();var _pos=new Phaser.Plugin.Isometric.Point3;this.game.iso.unproject(this.game.input.activePointer.position,_pos);this.isoGroup.forEach(function(tile){var inBounds=tile.isoBounds.containsXY(_pos.x,_pos.y);if(inBounds){this.cursor.isoX=tile.isoX;this.cursor.isoY=tile.isoY}},this)},__makeFloor:function(){var tile;for(var xx=0;xx<15*settings.tileSize;xx+=settings.tileSize){for(var yy=0;yy<15*settings.tileSize;yy+=settings.tileSize){tile=this.add.isoSprite(xx,yy,0,"floor",0,this.isoGroup)}}}}})();(function(){var Messages=function(){};var sakot;Messages.prototype={update:function(){},getMessage:function(){var data=Brew.game.cache.getJSON("texts");sakot=data.letters[0].content;return sakot}};Brew.Messages=Messages})();(function(){var Beer=function(){};var price;var name;var amount;var time;Beer.prototype={update:function(){},getBeer:function(){return this.name},sell:function(litres){this.amount=this.amount-litres},cook:function(litres){this.amount=this.amount+litres}};Brew.Beer=Beer})();(function(){var settings={dom:"#game"};var GUI=function(){this._messageWindow=$("<div><div/>").addClass("brew-messages").appendTo(settings.dom)};GUI.prototype.alert=function(message,callback,callbackCtx){$("<div><div/>").addClass("brew-window brew-alert").html(message).append(this.__makeButton("OK",function(){var p=$(this).parent();if(p.data("callback"))p.data("callback").call(p.data("callbackCtx"));p.hide("drop",200,"easeInBack",function(){this.remove()})})).appendTo(settings.dom).show("drop",200,"easeOutBack").data("callback",callback).data("callbackCtx",callbackCtx)};GUI.prototype.addMessage=function(header,message){$("<div><div/>").addClass("brew-window brew-message").html("<h2>"+header+"<h2>").append($("<div><div/>").addClass("brew-message-body brew-window").html(message)).click(function(){var $this=$(this);$this.toggleClass("brew-message-extended",200,"easeOutQuad");$this.children(".brew-message-body").toggle("slide",{easing:"easeOutQuad"},200)}).appendTo(this._messageWindow)};GUI.prototype.toggleMessages=function(){this._messageWindow.toggle("slide",{easing:"easeOutBounce"},200)};GUI.prototype.__makeButton=function(text,callback,callbackCtx){return $("<div></div>").addClass("brew-button").addClass("jotain").text(text).click(callback)};Brew.GUI=GUI})();(function(){var settings={dom:"#progressbar",progressStyle:{width:"100%",height:"25px"},wrapStyle:{background:"#f80",margin:"10px",overflow:"hidden",position:"relative"},barStyle:{background:"#ddd",left:"0",position:"absolute",top:"0"}};var money=100;var div;var bar;var Budget=function(){};Budget.prototype.update=function(percent){var message;if(percent<=0){percent=0;message="Menetit kaikki rahasi ja hävisit pelin."}else if(percent>=100){percent=100;message="Voitit pelin!"}else message="";div.data("percent",percent);this.moveProgressBar();return message};Budget.prototype.moveProgressBar=function(){var getPercent=div.data("percent")/100;var getProgressWrapWidth=div.width();var progressTotal=getPercent*getProgressWrapWidth;var animationLength=250;bar.stop().animate({left:progressTotal},animationLength)};Budget.prototype.create=function(){bar=$("<div>").css(settings.progressStyle).css(settings.barStyle);div=$("<div>").css(settings.progressStyle).css(settings.wrapStyle).data("percent",100).append(bar).appendTo(settings.dom)};Brew.Budget=new Budget})();